# 基金大师 Pro - 工业级App改造计划书

**更新时间**: 2026-02-02 16:45
**版本**: v2.0

---

## 一、现状分析

### 当前版本问题清单

| 类别 | 问题 | 严重程度 |
|------|------|----------|
| **数据源** | 天天基金API可能失效，无真实实时数据 | 🔴 严重 |
| **编码问题** | 基金名称乱码（GBK编码未处理） | 🔴 严重 |
| **功能缺失** | 设置页面、关于页面点击无反应 | 🔴 严重 |
| **登录系统** | 无用户登录功能，无法个性化服务 | 🔴 严重 |
| **功能缺失** | 无截图导入基金功能 | 🟡 中等 |
| **功能缺失** | 市场指数无实时数据 | 🟡 中等 |
| **智能化** | 智能推荐无真实AI分析 | 🟡 中等 |
| **功能缺失** | 估值预测、收益率计算不完善 | 🟡 中等 |
| **UI问题** | 多个按钮点击无响应，界面不够工业级 | 🟡 中等 |
| **稳定性** | 无错误处理和重试机制 | 🟡 中等 |

---

## 二、改造目标

### 核心目标
1. **可用性**：每个按钮都有功能，每个页面都能正常打开
2. **工业级**：稳定的数据源，完善的错误处理，良好的用户体验
3. **实时性**：估值、市场数据实时更新
4. **智能化**：真正的AI实时分析、智能推荐和操作建议
5. **便捷性**：支持截图导入基金
6. **个性化**：微信/邮箱登录，用户数据云同步
7. **美观性**：工业级UI设计，流畅动画

---

## 三、新增功能规格

### 新功能1：AI智能分析系统

**技术方案**：集成大语言模型实现智能基金分析

**AI能力清单**：
1. **持仓诊断**：分析持仓结构，给出调仓建议
2. **基金评测**：深度分析基金历史表现、经理能力
3. **市场解读**：每日AI生成市场简评
4. **智能问答**：用自然语言查询基金信息
5. **操作建议**：基于AI分析给出买卖时机
6. **风险预警**：AI识别潜在风险基金

**AI分析使用DeepSeek API**：
- API密钥：`sk-96ae91ab330848c98adb150381c3ac66`
- BaseURL：`https://api.deepseek.com/v1`
- 模型：`deepseek-chat`（非思考模式）
- 兼容OpenAI格式，可使用OpenAI SDK

**依赖包**：
```yaml
dependencies:
  # DeepSeek官方包
  deepseek_api: ^0.1.2
  # 或使用OpenAI兼容包
  openai: ^3.0.0
```

**集成代码示例**：
```dart
import 'package:deepseek_api/deepseek_api.dart';

final deepseek = DeepSeekAPI(
  apiKey: 'sk-96ae91ab330848c98adb150381c3ac66',
  baseUrl: 'https://api.deepseek.com/v1',
);

final response = await deepseek.chat.completions.create(
  model: 'deepseek-chat',
  messages: [
    {'role': 'system', 'content': '你是一位专业的基金投资顾问'},
    {'role': 'user', 'content': '请分析我的基金持仓...'},
  ],
);
```

**提示词模板**：
```
你是一位专业的基金投资顾问。请分析以下持仓数据：

{holdings_json}

请从以下维度提供分析：
1. 整体配置评价（30字以内）
2. 风险评估（0-100分）
3. 建议操作（买入/卖出/持有）
4. 具体基金推荐或替换建议
5. 风险提示

请用JSON格式回复，包含字段：summary, riskScore(0-100), action, recommendations[], riskWarnings[]
```

---

### 新功能2：用户登录系统

#### 2.1 微信登录

**依赖包**：
```yaml
dependencies:
  fluwx: ^3.12.3  # 微信Flutter SDK
  # 或
  wechat_kit: ^3.4.0  # 推荐，更稳定
```

**集成步骤**：
1. 在微信开放平台注册应用
2. 配置AppID和AppSecret
3. 实现微信授权登录流程

#### 2.2 邮箱登录/注册

**功能清单**：
1. 邮箱注册
2. 邮箱登录
3. 密码重置
4. 验证码发送

**安全措施**：
- 密码强度验证（8位以上，包含数字+字母）
- 验证码有效期15分钟
- 登录失败次数限制（5次后锁定15分钟）
- JWT Token自动续期

#### 2.3 用户数据同步

- 云端同步持仓
- 同步自选基金
- 同步设置
- 多设备数据同步

---

### 新功能3：工业级UI设计系统

#### 3.1 设计规范

**颜色系统**：
- 主色：#1890FF（蓝色）
- 功能色：成功(#52C41A)、警告(#FAAD14)、错误(#F5222D)
- 文字色：主要(#262626)、次要(#8C8C8C)
- 背景色：背景(#F5F5F5)、卡片(#FFFFFF)

**字体规范**：
- 标题：28px Bold, 24px W600
- 正文：16px Normal, 14px Normal
- 数字：RobotoMono等宽字体

**间距系统**：
- xs: 4px, sm: 8px, md: 16px, lg: 24px, xl: 32px

**圆角规范**：
- sm: 4px, md: 8px, lg: 12px, xl: 16px, xxl: 24px

#### 3.2 通用组件库

**核心组件**：
- PrimaryButton（主按钮）
- SecondaryButton（次按钮）
- AppCard（卡片）
- AppTextField（输入框）
- SkeletonCard（骨架屏）
- LoadingIndicator（加载指示器）

#### 3.3 动效系统

- 页面过渡动画（Fade + Slide）
- 数据更新动画（AnimatedSwitcher）
- 下拉刷新动画
- 骨架屏渐变动画

#### 3.4 深色模式支持

完整支持浅色/深色/跟随系统三种模式

---

### 新功能4：行情频道（新增）

**设计目标**：聚合各大板块涨跌，展示基金信息，类似同花顺/东方财富的行情页面

**核心功能**：

1. **板块分类展示**
   - 行业板块（消费、科技、医药、新能源等）
   - 概念板块（新能源车、半导体、白酒等）
   - 资金流向板块
   - 涨停板/跌停板

2. **板块详情页**
   - 板块涨跌幅排行
   - 板块内基金列表
   - 板块相关新闻资讯
   - 板块资金流向

3. **基金详情页**
   - 基本信息（名称、代码、净值）
   - 涨跌幅展示
   - 持仓按钮（可点击添加）
   - 基金相关新闻

**页面结构**：

```
行情频道
├── 搜索栏
├── 板块分类Tab
│   ├── 全部
│   ├── 行业
│   ├── 概念
│   └── 资金
├── 板块列表
│   ├── 板块名称
│   ├── 涨跌幅
│   ├── 领涨基金
│   └── 更多按钮 →
└── 板块详情页
    ├── 返回按钮
    ├── 板块信息
    ├── 涨跌幅趋势图
    ├── 资金流向
    └── 板块内基金列表
        ├── 基金名称/代码
        ├── 涨跌幅
        └── 持仓按钮
```

**数据源**：
1. 东方财富板块数据
2. 天天基金分类数据
3. 同花顺板块数据

---

## 四、改造计划（分阶段）

### 第一阶段：基础设施完善（基础架构）
**预计时间**：3-4小时

- [x] 修复乱码问题（GBK编码处理）
- [x] 创建api_service.dart
- [x] 创建cache_service.dart
- [x] 创建logger.dart
- [ ] 创建data_repository.dart
- [ ] 创建auth_service.dart
- [ ] 实现错误处理机制

### 第二阶段：用户系统（登录+数据同步）
**预计时间**：3-4小时

- [ ] 实现微信登录（wechat_kit）
- [ ] 实现邮箱注册/登录
- [ ] 实现用户数据云同步
- [ ] 实现JWT认证
- [ ] 创建设置页面
- [ ] 创建关于页面

### 第三阶段：智能功能增强（AI+实时数据）
**预计时间**：4-5小时

- [x] 创建ai_service.dart（DeepSeek集成）
- [ ] 实现持仓诊断功能
- [ ] 实现智能问答功能
- [ ] 接入市场实时数据（新浪/腾讯财经）
- [ ] 实现推荐评分算法
- [ ] 实现操作建议算法

### 第三阶段扩展：行情频道（新增）
**预计时间**：5-6小时

**新增页面**：
- [ ] lib/pages/market_page.dart（行情主页面）
- [ ] lib/pages/sector_detail_page.dart（板块详情页）
- [ ] lib/pages/fund_detail_page.dart（基金详情页）
- [ ] lib/providers/market_provider.dart（行情状态管理）
- [ ] lib/services/market_service.dart（行情数据服务）

**功能开发**：
- [ ] 行业板块列表展示
- [ ] 概念板块列表展示
- [ ] 板块内基金列表
- [ ] 基金详情页
- [ ] 涨跌幅排序
- [ ] 搜索功能
- [ ] 下拉刷新
- [ ] 加载更多

### 第四阶段：便捷功能（截图导入）
**预计时间**：2-3小时

- [ ] 实现截图导入（image_picker）
- [ ] 实现OCR识别（google_mlkit_text_recognition）
- [ ] 添加基金确认流程
- [ ] 批量导入功能

### 第五阶段：UI/UX优化（工业级）
**预计时间**：3-4小时

- [ ] 创建设计系统（颜色/字体/间距）
- [ ] 创建通用组件库
- [ ] 优化所有页面UI
- [ ] 添加数据可视化（fl_chart）
- [ ] 添加加载动画和骨架屏
- [ ] 完善深色模式
- [ ] 添加页面过渡动画

---

## 五、技术架构

```
┌─────────────────────────────────────┐
│           UI Layer (Flutter)        │
│  ┌─────────┬─────────┬───────────┐  │
│  │  Pages  │ Widgets │ Components│  │
│  └─────────┴─────────┴───────────┘  │
├─────────────────────────────────────┤
│         Business Logic Layer        │
│  ┌─────────────────────────────────┐│
│  │        Providers (状态管理)      ││
│  └─────────────────────────────────┘│
├─────────────────────────────────────┤
│           Service Layer             │
│  ┌─────────┬─────────┬───────────┐  │
│  │  API    │  Cache  │  AI       │  │
│  │ Service │ Service │ Service   │  │
│  └─────────┴─────────┴───────────┘  │
├─────────────────────────────────────┤
│            Data Layer               │
│  ┌─────────────────────────────────┐│
│  │  Repository + Local Storage     ││
│  └─────────────────────────────────┘│
├─────────────────────────────────────┤
│           Network Layer             │
│  ┌─────────────────────────────────┐│
│  │     Dio + Interceptors          ││
│  └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

---

## 六、依赖包清单

```yaml
dependencies:
  flutter:
    sdk: flutter
    
  # 状态管理
  provider: ^6.0.5
  get: ^4.6.5
  
  # 网络
  dio: ^5.3.0
  
  # 数据存储
  shared_preferences: ^2.2.0
  hive: ^2.2.3
  
  # UI
  google_fonts: ^6.1.0
  fl_chart: ^0.63.0
  intl: ^0.18.0
  
  # 登录
  wechat_kit: ^3.4.0  # 微信登录
  
  # 图片
  image_picker: ^1.0.0
  google_mlkit_text_recognition: ^0.11.0  # OCR
  
  # 工具
  charset: ^1.0.0  # 编码处理
  logger: ^2.0.0  # 日志
```

---

## 七、性能要求

| 指标 | 要求 |
|------|------|
| 页面加载速度 | < 1秒 |
| 数据刷新时间 | < 3秒 |
| 内存占用 | < 100MB |
| APK大小 | < 30MB |
| 帧率 | 60fps稳定 |

---

## 八、风险评估

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| API接口失效 | 中 | 高 | 多数据源备份 |
| OCR识别率低 | 中 | 中 | 人工确认流程 |
| AI服务不稳定 | 中 | 中 | 多模型切换 |
| 微信登录审核 | 低 | 中 | 准备资质材料 |
| 性能不达标 | 低 | 中 | 性能优化 |

---

## 九、总结

通过以上五个阶段的改造，基金大师Pro将具备：

1. ✅ **可用性**：每个功能都可正常使用
2. ✅ **稳定性**：多数据源保障，多重错误处理
3. ✅ **实时性**：市场数据实时更新
4. ✅ **智能化**：真正的AI实时分析
5. ✅ **便捷性**：截图导入，批量操作
6. ✅ **个性化**：微信/邮箱登录，云同步
7. ✅ **美观性**：工业级UI，流畅动画

---

**计划制定时间**：2026-02-02 16:45
